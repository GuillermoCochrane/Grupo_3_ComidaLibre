<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head.ejs') %>
<body>
  <%- include('../partials/header.ejs') %>
  <main class="main-user">
    <div class="profile-container">
      <div class="user-info-card">
        <div class="username-img-container">
          <img src="/images/avatar/<%= user.image %>" alt="profile_pic">
        </div>
          <div class="user-info-container">
            <div class="info-line">
              <h1><%= user.username %></h1>
            </div>
            <div class="info-line">
              <p class="field-name">Nombre</p>
              <p class="field-info"><%= user.first_name %> <%= user.last_name %></p>
            </div>
            <div class="info-line">
              <p class="field-name">Direccion</p>
              <p class="field-info"><%= user.address %></p>
            </div>
            <div class="info-line">
              <p class="field-name">Telefono</p>
              <p class="field-info"><%= user.phone %></p>
            </div>
            <div class="info-line">
              <p class="field-name">Email</p>
              <p class="field-info"><%= user.email %></p>
            </div>
            <div class="info-line">
              <p class="field-name">Categoria</p>
              <p class="field-info"><%= user.roles_id.role %></p>
            </div>
            <br>
            <div class="info-line">
              <a href="/user/edit/<%= user.id %>">Editar <i class="far fa-edit"></i></a>
            </div>
          </div>
      </div>
      <div class="user-sale-container">
        <h1>Compras realizadas</h1>
        <div class="sale-product-container">
          <% for(let sale of userSales) {%>
            <div>
              <p><strong>fecha de compra:</strong> <%= sale.created_at.toDateString() %></p>
              <p><strong>metodo de pago:</strong> <%= sale.payment_method %></p>
              <p><strong>total pagado:</strong> <%= sale.total %></p>
            </div>
            <ul>
              <% for(let item of userSalesDetails) {%>
                  <li>
                    <img src="/images/products/<%= item.saleDetail_product.image %>" alt="">
                    <div>
                      <%= item.saleDetail_product.name %> 
                    </div>
                    <div>
                        <%= item.saleDetail_product.price %> 
                    </div>
                    <div>
                      X<%= item.quantity %> 
                    </div>
                  </li>
                <% } %>
              <% } %>
            </ul>
        </div>
      </div>
      <div class="user-favs-container">
        <h1>Favoritos</h1>
        <div class="fav-product-container">          
          <% for(let fav of userFavourites) {%>
            <div class="fav-product-info">
              <img src="/images/products/<%= fav.fav_product.image %>" alt="">
              <div>
                <strong><%= fav.fav_product.name %></strong>
                <strong>$ <%= fav.fav_product.price %></strong>
              </div>
              <a href="/fav/delete/<%= fav.fav_product.id %>"><i class="fas fa-times"></i></a>
            </div>
          <% } %>          
        </div>
      </div>
    </div>
</main>
<%- include('../partials/footer.ejs') %> 
</body>
</html>